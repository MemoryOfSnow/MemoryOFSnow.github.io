<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blueinyou.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Paul C&#39;s Blog">
<meta property="og:url" content="https://blueinyou.com/index.html">
<meta property="og:site_name" content="Paul C&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Paul C">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blueinyou.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Paul C's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Paul C's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">To be funny,to grow up!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/Notes/Pediy02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/Notes/Pediy02/" class="post-title-link" itemprop="url">CPU体系架构回顾</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-08-02 14:19:49 / Modified: 17:50:26" itemprop="dateCreated datePublished" datetime="2023-08-02T14:19:49+08:00">2023-08-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://www.kanxue.com/chm.htm?id=13855&amp;pid=node1000002">https://www.kanxue.com/chm.htm?id=13855&amp;pid=node1000002</a></p>
</blockquote>
<h2 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h2><ul>
<li><p>MIPS  长度固定的指令，是RISC，处理器通过硬连线实现 </p>
</li>
<li><p>x86(IA-32)，长度变化，用CISC的指令集，CISC的处理器需要用微指令配合运行。但是当下Intel实际处理器的结构都已经变成了risc结构了，risc的结构实现流水线等特性比较容易。 </p>
</li>
</ul>
<p> cisc的寄存器数量较少，指令能够实现一些比较特殊的功能，例如Win32汇编语言对应的8086的一些寄存器： AX-DX，CS、DS、ES、SS。</p>
<p>GNU编译的elf文件对应到RISC的寄存器，会有很多通用寄存器。</p>
<p> 虚拟模式需要使用一些特殊的寄存器、为了支持分页需要使用页表寄存器等，为了加速内存的访问需要使用TLB，加速数据和指令的访问而使用data cache和instruction cache等 </p>
<blockquote>
<p>jmp $是为了让程序停在这一行，防止程序跑飞（跑飞的程序危害很大！有可能把数据当代码或者把代码当数据！）</p>
</blockquote>
<h3 id="仿真工具"><a href="#仿真工具" class="headerlink" title="仿真工具"></a>仿真工具</h3><p> 用synplify综合的电路，然后用debussy+modelsim仿真 </p>
<h2 id="IA-32的指令格式"><a href="#IA-32的指令格式" class="headerlink" title="IA-32的指令格式"></a>IA-32的指令格式</h2><p><img src="/categories/Notes/Pediy02/1690965899478.png" alt="1690965899478"></p>
<p>前缀部分可选，分为四个group。</p>
<p> 操作数前缀用于设置 锁总线和重复前缀 、段重写和分支预测、操作数宽度、地址宽度。</p>
<h3 id="Opcode"><a href="#Opcode" class="headerlink" title="Opcode"></a>Opcode</h3><ol>
<li><p>x86的opcode最短是1个字节，最长是3个字节。 </p>
</li>
<li><p>x86对于源操作数和目的操作数是暗含在opcode里面的。 </p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">88 11 BL(011) CL(001)     88 D9 MOV CL, BL               MR   </span><br><span class="line">8A 11 011 001             8A D9 MOV BL(011),CL(001)      R&lt;--M</span><br></pre></td></tr></table></figure>
<ol>
<li><p>二字节通用opcode是0fh+一字节的编码；但是二字节的SIMD opcode是三字节长度，即一个强制前缀+0fh+一字节的操作码。 </p>
</li>
<li><p>同样的，三字节的通用opcode，是0fh+二字节的编码。SIMD opcode格式是强制前缀+0FH+二字节编码。 </p>
<p>5.个别的SIMD指令不需要强制前缀来引导，比如addps(0FH+58H) </p>
</li>
</ol>
<blockquote>
<p> <code>addps</code>指令中，<code>ps</code>代表”packed single-precision floating-point” 。</p>
<p>XMM （eXtended MultiMedia ） 寄存器是SSE（Streaming SIMD Extensions）指令集中的一种寄存器。</p>
<p>它可以同时存储4个单精度浮点数，每个数占用32位，总共128位。</p>
<p>对应的，MM寄存器是64位的。</p>
<p><code>addps</code>指令将分别对应位置上的单精度浮点数相加，并将结果存储回目标XMM寄存器中。 </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0F 58 01  addps xmm0,xmmword ptr[ecx] //从内存位置ecx处取128位单精度浮点数值加到xmm0 寄存器中的128位单精度浮点数上</span><br></pre></td></tr></table></figure>
<h3 id="Mod-R-M"><a href="#Mod-R-M" class="headerlink" title="Mod R/M"></a>Mod R/M</h3><p>切分为3个位域，233.</p>
<p> mod:提供寻址模式，11=寄存器寻址 其余都是内存寻址<br> reg/opcode：<br>  两种作用，第一种是提供寄存器寻址；另一种为某些opcode提供补充说明。<br> R/M：<br>  结合MOD位域，提供内存/寄存器寻址。 </p>
<p> R/M=100&amp; MOD≠11 作为SIB的转义码 。</p>
<p>例如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">编码mov eax(000)，ebx(011)</span><br><span class="line">89H       11        011    000  89 D8                MR</span><br><span class="line">8BH       11        000    011  8B C3                RM</span><br><span class="line">//x86把源和目的操作数隐藏在opcode里面</span><br></pre></td></tr></table></figure>
<p><img src="/categories/Notes/Pediy02/1690969519285.png" alt="1690969519285"></p>
<h3 id="SIB"><a href="#SIB" class="headerlink" title="SIB"></a>SIB</h3><p> 同modr/m类似，SIB字节也是采用233切分成三个位域，名字分别叫Scale、Index、Base。SIB的名字也来自这三个位域名字的首字母缩写。<br> SIB字节由 R/M=100&amp; MOD≠11 引导出来。<br>1.SIB确定的寻址方式是[base+Index* Scale +disp]， </p>
<blockquote>
<p>esp作为index时候，index自动被忽略,即此时scale因子视为0 ， 寻址计算方法是[base+disp] </p>
</blockquote>
<p>2.disp意思是后面尾随的若干个displacement字节。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mov eax，[0x1]可以编码为以下形式：</span><br><span class="line">a）采用moffs32编码</span><br><span class="line">   opcode moffs32</span><br><span class="line">   A1    01 00 00 00</span><br><span class="line">   A1    40H</span><br><span class="line">b）采用MODR/M引导的disp</span><br><span class="line">  opcode   mod   reg   r/m  displacement</span><br><span class="line">  8B       00    000   101  01 00 00 00H</span><br><span class="line">  8B       05H              01 00 00 00H</span><br><span class="line">c）采用SIB引导的disp</span><br><span class="line">  opcode   mod   reg   r/m  scale    index  base   displacement</span><br><span class="line">  8B       00    000   100    01     100    101  01 00 00 00H</span><br><span class="line">  8B       04H                65H                01 00 00 00H</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/ML/APT02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/ML/APT02/" class="post-title-link" itemprop="url">一些论文问题的总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-31 17:13:22 / Modified: 17:18:49" itemprop="dateCreated datePublished" datetime="2023-07-31T17:13:22+08:00">2023-07-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-数据不平衡问题"><a href="#1-数据不平衡问题" class="headerlink" title="1.数据不平衡问题"></a>1.数据不平衡问题</h2><h2 id="2-数据饥饿问题"><a href="#2-数据饥饿问题" class="headerlink" title="2.数据饥饿问题"></a>2.数据饥饿问题</h2><h2 id="3-静态检测时混淆加密手段的干扰"><a href="#3-静态检测时混淆加密手段的干扰" class="headerlink" title="3.静态检测时混淆加密手段的干扰"></a>3.静态检测时混淆加密手段的干扰</h2><h2 id="4-运行崩溃的解决"><a href="#4-运行崩溃的解决" class="headerlink" title="4.运行崩溃的解决"></a>4.运行崩溃的解决</h2><h2 id="5-样本中特征不足导致矩阵全0"><a href="#5-样本中特征不足导致矩阵全0" class="headerlink" title="5.样本中特征不足导致矩阵全0"></a>5.样本中特征不足导致矩阵全0</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/ML/APT01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/ML/APT01/" class="post-title-link" itemprop="url">面向 APT 家族分析的攻击路径预测方法研究</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-31 16:13:22 / Modified: 17:51:48" itemprop="dateCreated datePublished" datetime="2023-07-31T16:13:22+08:00">2023-07-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>面向 APT 家族分析的攻击路径预测方法研究，信息学报，陈伟翔 1, 任怡彤 1, 肖岩军 2, 侯 锐 3, 田志宏 1 </p>
</blockquote>
<p>IDS需要关联 APT 生命周期内的数 个阶段, 以此提高检测攻击能力。</p>
<h2 id="1-要解决的问题"><a href="#1-要解决的问题" class="headerlink" title="1.要解决的问题"></a>1.要解决的问题</h2><p>基因库—可靠数据获取方法</p>
<p>HMM——预测的攻击路径的可解释性</p>
<h2 id="2-概念"><a href="#2-概念" class="headerlink" title="2.概念"></a>2.概念</h2><h3 id="攻击行为概述"><a href="#攻击行为概述" class="headerlink" title="攻击行为概述"></a>攻击行为概述</h3><p>“寻找入口点”、“C2 通信”、“权限提升”、“资 产发现”、“数据过滤”、</p>
<h3 id="APT-攻击路径的可见状态集"><a href="#APT-攻击路径的可见状态集" class="headerlink" title="APT 攻击路径的可见状态集"></a>APT 攻击路径的可见状态集</h3><h4 id="注册表-amp-服务"><a href="#注册表-amp-服务" class="headerlink" title="注册表&amp;服务"></a>注册表&amp;服务</h4><p>CS(create-service): 创建服务</p>
<p>MRV(modify-registry-value): 修 改注册表的行为; </p>
<p>DRKV(delete-registry-key-value): 删除注册表关键信息的行为; </p>
<h4 id="内核"><a href="#内核" class="headerlink" title="内核"></a>内核</h4><p>CKO(create-kernelobject): 创建内核对象的行为;  </p>
<p>MMP(modify-memory-property): 修 改内存权限的行为; </p>
<h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>CP(create-process): 创建进程;</p>
<p>LL(load-library): 加载 库 ;</p>
<p>ESI(execshellcode-instr): 执行 shellcode 指令; </p>
<p>EHI(exec-heapinstr): 执行堆指令;</p>
<p>WTPM(write-to-process-memory): 写入进程内存;</p>
<p> ERI(exec-ret-instr): 执行 ret 指令;</p>
<p> EEI(exec-esp-instr): 执行 esp 指令;</p>
<p> CT(create-thread): 创建线程; </p>
<h4 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h4><p>SDQ(send-dnsquery): 发送 DNS 请求行为;</p>
<p>SNP(send-network-packet): 发送网络数据包;</p>
<p>LOP(listen-on-port): 监听端口。</p>
<p>CTS(connect-to-socket): 连接 socket;</p>
<h4 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h4><p>CF(create-process): 创 建文件的行为;</p>
<p> WTF(write-to-file): 写入文件的行为;</p>
<h3 id="动态分析工具"><a href="#动态分析工具" class="headerlink" title="动态分析工具"></a>动态分析工具</h3><p>Anubis、Norman、Joebox</p>
<h3 id="基因库"><a href="#基因库" class="headerlink" title="基因库"></a>基因库</h3><p>基因(序列)：(MD5,env,object_1,object_2,action_name)按照时间排序</p>
<p>object_1 与 object_2 分别代表软件执行动作的对象 和路径</p>
<p>同一个 APT 家族下恶意软件基因集合, 称为一个 APT 家族的基 因库。</p>
<h3 id="钻石模型"><a href="#钻石模型" class="headerlink" title="钻石模型"></a>钻石模型</h3><p>一个 APT 攻击包含“攻击者”、 “受害者”、 “能力”和“基础设施”4 个核心元 素。</p>
<p>“能力”是攻击者使用的工具或技术, 从 探查到最终目的达成, “技术”存在于每一个攻击阶 段, 每一个恶意动作对应的技术细节可体现出相应 战略意图。</p>
<p>“基础设施”是攻击者维持权限控制的通 道或者载体。</p>
<h2 id="3-方法"><a href="#3-方法" class="headerlink" title="3.方法"></a>3.方法</h2><h2 id="Smith-waterman算法"><a href="#Smith-waterman算法" class="headerlink" title="Smith waterman算法+"></a>Smith waterman算法+</h2><p>相似的公共子序列一定是得分最高的那一条。</p>
<p> <strong>比对序列为：A=GGTTGACTA，B=TGTTACGG</strong> </p>
<p>则两序列的长度分别为len(A) = n，Len(B)=m；<br>s(a,b)：字符a和字符b的相似分数，这里设置为3，不相等则为-3；</p>
<p>W1 = 2 ：一个空位罚分，这里设置为2（可根据需要设置） </p>
<p>H：匹配分数矩阵如下。</p>
<p><img src="/categories/ML/APT01/1690796434417.png" alt="1690796434417"></p>
<ol>
<li>初始化算法分数矩阵H。A是列向量，B是行向量。使行i表示字符ai，列j表示字符bj；</li>
<li></li>
</ol>
<p><img src="/categories/ML/APT01/1690796255740.png" alt="1690796255740"></p>
<ol>
<li>回溯，从矩阵H中分数最大的一项开始：<br>若ai=bj，则回溯到左上角单元格<br>若ai≠bj，回溯到左上角、上边、左边中值最大的单元格，若有相同最大值的单元格，优先级按照左上角、上边、左边的顺序</li>
<li>根据回溯路径，写出匹配字符串：<br>若回溯到左上角单元格，将ai添加到匹配字串A‘，将bj添加到匹配字串B’；<br>若回溯往上走，此时A走了，B没走。将ai添加到匹配字串A’，将_添加到匹配字串B’；<br>若回溯到左边单元格，B走了，A没走。将_添加到匹配字串A’，将bj添加到匹配字串B’。</li>
<li>得到局部最优匹配序列，结束</li>
</ol>
<h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><p>1.<strong>APT基因库</strong>要去重、去无效、去冗余（Smith-waterman局部序列对比算法去除相似基因，阈值为80%）。</p>
<p>-&gt;节省存储、简化算法复杂度</p>
<p>基因个体不重要，基因行为才重要。：(MD5,env,object_1,object_2,action_name)，去除md5，env作关键词替换，object1只保留可执行文件。</p>
<p>2.<strong>公共基因：</strong>对所有APT基因库中的基因进行相似度检测，相似度90%以上的基因序列作为公共基因。</p>
<p>恶意软件的通用动作。</p>
<p>3.<strong>恶意行为基因库</strong>：各个家族APT基因库-公共基因，之后合并各个家族基因库。</p>
<p>4.可观测状态集：<strong>恶意软件行为可观测链：</strong>恶意软件基因序列,与恶意行为基因库进行比较。保留相似度 Thres_hold 在 90%以上的基因序列的基因尾的动作名称，不包含基因段属性信息，从而保证可观测状态可计算属性。</p>
<h4 id="缺陷1："><a href="#缺陷1：" class="headerlink" title="缺陷1："></a>缺陷1：</h4><p>恶意行为基因库进 行可观测链提取, 而这些基因序列来自于软件行为。</p>
<p>只能使用基因中 包含 C2 通信的部分进行关联和提取, 基因库的使用 率不足 30%,</p>
<p>5.隐藏状态集 资产发现 数据过滤 寻找入口 C2 通信</p>
<p>将测试集 中的样本放入各自的 APT 家族的 HMM 中计算下一 时刻攻击路径的隐藏状态和可观测状态的概率</p>
<h3 id="展示结果时"><a href="#展示结果时" class="headerlink" title="展示结果时"></a>展示结果时</h3><p>将各个家族样本按照编号排序，把得分取对数，构成下面的得分图。</p>
<p><img src="/categories/ML/APT01/1690793540423.png" alt="1690793540423"></p>
<h2 id="4-优势"><a href="#4-优势" class="headerlink" title="4.优势"></a>4.优势</h2><h3 id="1-精准定位到具体基因"><a href="#1-精准定位到具体基因" class="headerlink" title="1.精准定位到具体基因"></a>1.精准定位到具体基因</h3><hr>
<p>能精准定位到具体基因, 能在一定程度上应对 恶意软件变种, 能在一定程度上应对 恶意软件变种</p>
<h3 id="2-可同时对隐藏状态和可观测状态展开预测"><a href="#2-可同时对隐藏状态和可观测状态展开预测" class="headerlink" title="2.可同时对隐藏状态和可观测状态展开预测"></a>2.可同时对隐藏状态和可观测状态展开预测</h3><h3 id="3-在进行最终结果判定时-将多个观测值作为判定结果"><a href="#3-在进行最终结果判定时-将多个观测值作为判定结果" class="headerlink" title="3.在进行最终结果判定时, 将多个观测值作为判定结果"></a>3.在进行最终结果判定时, 将多个观测值作为判定结果</h3><p>只要结果在观测值组里，就正确，可以提高实验表现，也能提供参考。</p>
<h2 id="劣势"><a href="#劣势" class="headerlink" title="劣势"></a>劣势</h2><p>隐藏状态只有四个；</p>
<p>在 数据质量方面, 若一条观测链在多个模型下均展现 出极少或是单一的 APT 阶段, 就会严重影响 HMM 的构建。</p>
<p>在多个路径时，基因检测的识别准确率不如 HMM 检测法, 但是</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/ML/Few-Shot19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/ML/Few-Shot19/" class="post-title-link" itemprop="url">利用三阶段特征选择和数据不平衡纠正增强勒索软件分类</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-31 16:13:22 / Modified: 17:16:32" itemprop="dateCreated datePublished" datetime="2023-07-31T16:13:22+08:00">2023-07-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>勒索软件维度太多、数据不平衡，不容易建立模型。</p>
<ul>
<li>考虑样本不同特征组的重要程度，三阶段特征选择，解决样本维度问题；</li>
<li>代价敏感学习(Cost Sensitive Learning)和SMOTE重采样解决数据不平衡问题。</li>
</ul>
<h3 id><a href="#" class="headerlink" title=" "></a> </h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/Notes/IDAPro01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/Notes/IDAPro01/" class="post-title-link" itemprop="url">SP-Analysis failed[Xctf g0Re]</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-29 14:58:58" itemprop="dateCreated datePublished" datetime="2023-07-29T14:58:58+08:00">2023-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-07-30 21:24:56" itemprop="dateModified" datetime="2023-07-30T21:24:56+08:00">2023-07-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>xctf的一道Go语言逆向题，涉及AES加密和base64换表加密。</p>
<p>用IDA打开g0Re报告<code>SP-Analysis failed</code>错误。</p>
<p><img src="/categories/Notes/IDAPro01/1690613919182.png" alt="1690613919182"></p>
<h2 id="静态检测"><a href="#静态检测" class="headerlink" title="静态检测"></a>静态检测</h2><p>将文件拷贝到kali后，静态检测一番。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ file g0Re               </span><br><span class="line">g0Re: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, no section header</span><br><span class="line"></span><br><span class="line">readelf -hlS --w g0Re</span><br></pre></td></tr></table></figure>
<p>报告如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">readelf: Warning: Section 49 has an out of range sh_link value of 2302008908</span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ 0] &lt;no-strings&gt;      00010102: &lt;unknown&gt; 00000001003e0002 481cb0 000040 400003      0   0 15762873573703680</span><br><span class="line">readelf: Warning: [ 1]: Link field (533963) should index a symtab section.</span><br><span class="line">readelf: Warning: [ 3]: Unexpected value (1482181455) in info field.</span><br></pre></td></tr></table></figure>
<p>strings找到一些特征字符串<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/idawork]</span><br><span class="line">└─$ strings -a  -tx g0Re|grep -E &#x27;\s&#123;4,30&#125;&#x27;</span><br><span class="line">     ec OKXX$</span><br><span class="line">    13e FN&#123;o</span><br><span class="line">    1e6 r mL</span><br><span class="line">    284 dRe6eYPgXygMd</span><br><span class="line">    295 fSCPpMP/C9DU36D2kliiYS5D9wKG/E_p</span><br><span class="line">    2b9 XkJb3WwcGMbUPd63r/bG8gVDS6EsZ5vv</span><br><span class="line">  81e18 $Info: This file is packed with the                                           </span><br><span class="line">  81e67 $Id:  </span><br></pre></td></tr></table></figure></p>
<p>猜测是UPX加壳，但是UPX标志被抹去了。</p>
<h2 id="UPX-标志被抹除"><a href="#UPX-标志被抹除" class="headerlink" title="UPX! 标志被抹除"></a>UPX! 标志被抹除</h2><p>unpack时会依次在三个地方检查UPX_MAGIC_LE32（即”UPX!”）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、在倒数第36字节偏移处检查，如果特征值不符就会转入throwNotPacked()异常抛出函数，打印not packed by UPX；</span><br><span class="line">2、&quot;.ELF&quot;魔数前36字节处，如果这里的特征值不符就会转入throwCantUnpack()异常抛出函数，打印l_info corrupted；</span><br><span class="line">3、 在倒数第46字节偏移处检查，如果特征值不符就会转入throwCompressedDataViolation()异常抛出函数，打印Exception: compressed data violation；</span><br></pre></td></tr></table></figure>
<p><img src="/categories/Notes/IDAPro01/1690711701628.png" alt="1690711701628"></p>
<p>结合上面的规则2，可以很清晰地判断出出题人用<code>0KXX</code>代替了<code>UPX!</code>。</p>
<p><img src="/categories/Notes/IDAPro01/1690712364661.png" alt="1690712364661"></p>
<p>在对应的三个位置处换上UPX!魔数。</p>
<p><img src="/categories/Notes/IDAPro01/1690713002432.png" alt="1690713002432"></p>
<p><img src="/categories/Notes/IDAPro01/1690712555711.png" alt="1690712555711"></p>
<p>upx脱壳。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/idawork]</span><br><span class="line">└─$ upx -d g0Re_upx </span><br><span class="line">                       Ultimate Packer for eXecutables</span><br><span class="line">                          Copyright (C) 1996 - 2020</span><br><span class="line">UPX 3.96        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Jan 23rd 2020</span><br><span class="line"></span><br><span class="line">        File size         Ratio      Format      Name</span><br><span class="line">   --------------------   ------   -----------   -----------</span><br><span class="line">   1331200 &lt;-    534092   40.12%   linux/amd64   g0Re_upx</span><br><span class="line"></span><br><span class="line">Unpacked 1 file.</span><br></pre></td></tr></table></figure>
<h2 id="输入flag后的处理流程"><a href="#输入flag后的处理流程" class="headerlink" title="输入flag后的处理流程"></a>输入flag后的处理流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_int64 __usercall sub_48CD80@&lt;rax&gt;(__int64 i%16@&lt;rdi&gt;, __int64 key[i%16]@&lt;rsi&gt;, __int64 a3@&lt;r14&gt;, __int128 a4@&lt;xmm15&gt;)</span><br></pre></td></tr></table></figure>
<p>1.aes   2.base64    3.简单运算</p>
<p><img src="/categories/Notes/IDAPro01/1690723199822.png" alt="1690723199822"></p>
<p><img src="/categories/Notes/IDAPro01/1690723104727.png" alt="1690723104727"></p>
<h2 id="aes加密-密钥获取"><a href="#aes加密-密钥获取" class="headerlink" title="aes加密 密钥获取"></a>aes加密 密钥获取</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">动态调试获取密钥：wvgitbygwbk2b46d</span><br></pre></td></tr></table></figure>
<p>启动ida服务端。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#端口，密码，详细模式</span></span><br><span class="line"><span class="comment">#若希望同时维护几个调试实例，就要在不同端口启动调试服务器。</span></span><br><span class="line">./linux_server64 -p23946 -p23946 -v</span><br><span class="line">IDA Linux 64-bit remote debug server(ST) v1.22. Hex-Rays (c) 2004-2017</span><br><span class="line">Listening on 0.0.0.0:23946...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/categories/Notes/IDAPro01/1690716983450.png" alt="1690716983450"></p>
<p>Hex窗口与RSI同步。</p>
<p><img src="/categories/Notes/IDAPro01/1690718805904.png" alt="1690718805904"></p>
<h2 id="base64换表加密"><a href="#base64换表加密" class="headerlink" title="base64换表加密"></a>base64换表加密</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strings -tx g0Re_upx|grep -E &#x27;[A-Z]&#123;10,64&#125;&#x27; </span><br><span class="line">12c040 456789&#125;#IJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123ABCDEFGH</span><br></pre></td></tr></table></figure>
<h2 id="解密脚本"><a href="#解密脚本" class="headerlink" title="解密脚本"></a>解密脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">string1 = <span class="string">&quot;456789&#125;#IJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123ABCDEFGH&quot;</span></span><br><span class="line">string2 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"><span class="comment">#ascii字符范围</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_printable_chars</span>(<span class="params">flag</span>):</span><br><span class="line">    filtered_flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="keyword">if</span> byte <span class="keyword">in</span> string1:</span><br><span class="line">            filtered_flag+=byte</span><br><span class="line">        <span class="comment">#else:</span></span><br><span class="line">            <span class="comment">#print(&quot;ERROR&quot;)</span></span><br><span class="line">            <span class="comment">#break</span></span><br><span class="line">    <span class="keyword">return</span> filtered_flag</span><br><span class="line"></span><br><span class="line">enc=[    <span class="number">0xE6</span>, <span class="number">0xCE</span>, <span class="number">0x89</span>, <span class="number">0xC8</span>, <span class="number">0xCF</span>, <span class="number">0xC5</span>, <span class="number">0xF5</span>, <span class="number">0xC9</span>, <span class="number">0xD2</span>, <span class="number">0xD9</span>,   <span class="number">0xC0</span>, <span class="number">0x91</span>, <span class="number">0xCE</span>, <span class="number">0x7F</span>, <span class="number">0xAC</span>, <span class="number">0xCC</span>, <span class="number">0xE9</span>, <span class="number">0xCF</span>, <span class="number">0xB7</span>, <span class="number">0xC0</span>,   <span class="number">0x96</span>, <span class="number">0xD4</span>, <span class="number">0xEA</span>, <span class="number">0x92</span>, <span class="number">0xE2</span>, <span class="number">0xD7</span>, <span class="number">0xDF</span>, <span class="number">0x84</span>, <span class="number">0xCB</span>, <span class="number">0xA5</span>,   <span class="number">0xAE</span>, <span class="number">0x93</span>, <span class="number">0xA6</span>, <span class="number">0xCA</span>, <span class="number">0xBE</span>, <span class="number">0x97</span>, <span class="number">0xDF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xC9</span>,   <span class="number">0xB7</span>, <span class="number">0xE1</span>, <span class="number">0xAE</span>, <span class="number">0x6B</span>, <span class="number">0xC4</span>, <span class="number">0xB1</span>, <span class="number">0x65</span>, <span class="number">0xDB</span>, <span class="number">0xCE</span>, <span class="number">0xED</span>,   <span class="number">0x92</span>, <span class="number">0x93</span>, <span class="number">0xD6</span>, <span class="number">0x8C</span>, <span class="number">0xED</span>, <span class="number">0xC3</span>, <span class="number">0xA3</span>, <span class="number">0xDA</span>, <span class="number">0x94</span>, <span class="number">0xA5</span>,   <span class="number">0xAA</span>, <span class="number">0xB2</span>, <span class="number">0xB5</span>, <span class="number">0xA7</span>, <span class="number">0x55</span>]</span><br><span class="line">key=<span class="string">b&quot;wvgitbygwbk2b46d&quot;</span></span><br><span class="line">base = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):    </span><br><span class="line">    base+=<span class="built_in">chr</span>(((enc[i]-key[i%<span class="number">16</span>])^<span class="number">0x1a</span>) &amp;<span class="number">0xff</span>)</span><br><span class="line"><span class="built_in">print</span>(base)<span class="comment">#uB8EAyfxAmOEvQlrhCJM8hk1qonHskb55NM4qvmxZeY#xg5mMm10x0nF6b3iRdeYÄ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤base64编码表里的字符</span></span><br><span class="line">str1=filter_printable_chars(base)</span><br><span class="line">result=base64.b64decode(str1.translate(<span class="built_in">str</span>.maketrans(string1,string2)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#AES解密</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES<span class="comment"># </span></span><br><span class="line">aes = AES.new(key,mode=AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(aes.decrypt(result)) <span class="comment">#b&#x27;flag&#123;g0_1s_th3_b3st_1anguage_1n_the_wOrld!_xxx&#125;\x01&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="反汇编算法"><a href="#反汇编算法" class="headerlink" title="反汇编算法"></a>反汇编算法</h2><ul>
<li>1.线性扫描反汇编 关键是确定代码起始位置，之后线性扫描整个代码段，并逐条反汇编每条指令。不会识别分支来解释控制流。<ul>
<li>优点：覆盖程序的所有代码段；</li>
<li>缺点：假设代码段中全是代码，没法处理代码段中混入的数据。</li>
</ul>
</li>
<li>2.递归下降反汇编。根据指令间的引用关系决定是否反汇编，在一个代码块内部，还是使用线性扫描算法。<ul>
<li>优点：大部分情况下可以区分代码和数据。</li>
<li>缺点：无法处理间接代码路径。</li>
</ul>
</li>
</ul>
<p>IDA pro是递归下降反汇编器。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//add、xor、mov、栈操作push</span></span><br><span class="line"><span class="keyword">case</span> 顺序流指令:</span><br><span class="line">	线性扫描反汇编</span><br><span class="line"><span class="comment">//jnz、ja</span></span><br><span class="line"><span class="keyword">case</span> 条件分支指令:</span><br><span class="line">	反汇编两个路径，直接反汇编下一条指令对应的分支，将跳转目标指令的地址加入延迟反汇编地址列表。</span><br><span class="line"><span class="comment">//jmp</span></span><br><span class="line"><span class="keyword">case</span> 无条件分支指令:</span><br><span class="line">	确定跳转目标，反汇编目的地址；对于无条件分支后的字节不作处理。</span><br><span class="line">，</span><br><span class="line"><span class="comment">//call</span></span><br><span class="line"><span class="keyword">case</span> 函数调用指令:</span><br><span class="line">	运行方式类似于无条件跳转，但是其后的返回地址会被直接反汇编，将跳转目标指令的地址加入延迟反汇编地址列表。</span><br><span class="line"><span class="comment">//ret,</span></span><br><span class="line"><span class="keyword">case</span> 返回指令:</span><br><span class="line">	获取接下来将要执行的指令信息；有时需要从栈顶获取，而静态反汇编器不具备访问栈的能力。此时反汇编器会开始处理延迟反汇编地址列表。</span><br></pre></td></tr></table></figure>
<h2 id="反汇编出问题的情形"><a href="#反汇编出问题的情形" class="headerlink" title="反汇编出问题的情形"></a>反汇编出问题的情形</h2><p>1.对于无条件分支指令，例如jmp eax这样的运行时才能确定跳转地址的指令，需要人工赋值。</p>
<p>2.call指令，在函数内部篡改了函数返回地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">foo proc near</span><br><span class="line">	inc  dword ptr[esp];</span><br><span class="line">	retn</span><br><span class="line">endp</span><br><span class="line">//错误的反汇编</span><br><span class="line">E8 F7 FF FF FF call foo</span><br><span class="line">05 89 45 F8 90 add eax,90F84589h</span><br><span class="line"></span><br><span class="line">//正确的反汇编</span><br><span class="line">E8 F7 FF FF FF call foo</span><br><span class="line">05 				db  5</span><br><span class="line">89 45 F8 		mov [ebp-8],eax</span><br><span class="line">90 				nop</span><br></pre></td></tr></table></figure>
<p>3.ret没有提供返回地址。</p>
<p><img src="/categories/Notes/IDAPro01/1690714484074.png" alt="1690714484074"></p>
<p> IDA遇到的函数返回语句，检测到其栈指针值不为0。</p>
<h2 id="反汇编的困难"><a href="#反汇编的困难" class="headerlink" title="反汇编的困难"></a>反汇编的困难</h2><p>1.编译，和自然语言的翻译一样是一个多对多操作。除了C编译器，还有Go、Python、Delphi编译器、WinAPI库，反编译器非常依赖语言和库。</p>
<p>2.编译过程中会丢失命名和类型信息。反汇编后最多知道变量的位数，类型信息需要通过变量的用途确定。</p>
<h2 id="一些静态工具用法"><a href="#一些静态工具用法" class="headerlink" title="一些静态工具用法"></a>一些静态工具用法</h2><ul>
<li><p>Linux:ldd；  nm展示符号，C++filter、展示重定义。</p>
</li>
<li><p>OSX:otool；  处理MACH-O。</p>
</li>
<li><p>Windows:VS里的dumpbin /dependents  ；objdump</p>
</li>
</ul>
<h3 id="ldd显示依赖库"><a href="#ldd显示依赖库" class="headerlink" title="ldd显示依赖库"></a>ldd显示依赖库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/idawork]</span><br><span class="line">└─$ ldd linux_server64 </span><br><span class="line">        linux-vdso.so.1 (0x00007fff323bf000)</span><br><span class="line">        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fbfef767000)</span><br><span class="line">        libthread_db.so.1 =&gt; /lib/x86_64-linux-gnu/libthread_db.so.1 (0x00007fbfef75c000)</span><br><span class="line">        librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007fbfef751000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fbfef730000)</span><br><span class="line">        libstdc++.so.6 =&gt; /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fbfef515000)</span><br><span class="line">        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fbfef3d2000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fbfef1f6000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fbfef782000)</span><br><span class="line">        libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fbfef1d6000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="dumpbin-dependents"><a href="#dumpbin-dependents" class="headerlink" title="dumpbin /dependents"></a>dumpbin /dependents</h3><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Dump of file baby.exe</span><br><span class="line"></span><br><span class="line">File <span class="built_in">Type</span>: EXECUTABLE IMAGE</span><br><span class="line"></span><br><span class="line">  Image has the following dependencies:</span><br><span class="line"></span><br><span class="line">    KERNEL32.dll</span><br><span class="line">    msvcrt.dll</span><br><span class="line">    msvcrt.dll</span><br><span class="line"></span><br><span class="line">  Summary</span><br><span class="line"></span><br><span class="line">        <span class="number">1000</span> .CRT  C runtime Lib</span><br><span class="line">        <span class="number">1000</span> .bss</span><br><span class="line">        <span class="number">1000</span> .data</span><br><span class="line">        <span class="number">1000</span> .debug_abbrev</span><br><span class="line">        <span class="number">1000</span> .debug_aranges</span><br><span class="line">        <span class="number">1000</span> .debug_frame</span><br><span class="line">        <span class="number">2000</span> .debug_info</span><br><span class="line">        <span class="number">1000</span> .debug_line</span><br><span class="line">        <span class="number">1000</span> .eh_frame</span><br><span class="line">        <span class="number">1000</span> .idata</span><br><span class="line">        <span class="number">1000</span> .rdata</span><br><span class="line">        <span class="number">3000</span> .text</span><br><span class="line">        <span class="number">1000</span> .tls</span><br></pre></td></tr></table></figure>
<h3 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h3><p>-t 显示字符的文件偏移</p>
<p>-a 使得strings扫描整个文件，而非只有文件中可加载的、经初始化的部分</p>
<p>-e 搜素其他字符编码，如Unicode</p>
<p>几乎不会用到的工具：x86流式反汇编器，ndisasm和diStorm。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/Notes/Win32_01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/Notes/Win32_01/" class="post-title-link" itemprop="url">Windows汇编语言基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-18 14:58:58" itemprop="dateCreated datePublished" datetime="2023-07-18T14:58:58+08:00">2023-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-02 16:33:57" itemprop="dateModified" datetime="2023-08-02T16:33:57+08:00">2023-08-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="x86汇编语法"><a href="#x86汇编语法" class="headerlink" title="x86汇编语法"></a>x86汇编语法</h2><ul>
<li>AT&amp;T：GNU工具（Gas：GNU汇编器、gcc、gdb)         <ul>
<li>前缀：%reg,$立即数</li>
<li>操作数排序：mov 源操作数,目的操作数  add $0x4,%eax</li>
</ul>
</li>
<li>Intel ：MASM(微软汇编器)、Turbo汇编器、NASM<ul>
<li>add eax,0x4</li>
</ul>
</li>
</ul>
<p>.model flat，平坦模式，代码段和数据段共用一个4G段。</p>
<h2 id="局部变量、"><a href="#局部变量、" class="headerlink" title="局部变量、"></a>局部变量、</h2><p><strong>局部变量是堆栈变量</strong>。作用域是单个子程序，从子程序返回到主程序时被释放。一种规范写法是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOCAL @buffer[10]:BYTE ;LOCAL 变量名1[重复数量]:类型,变量名2[重复数量]:类型</span><br></pre></td></tr></table></figure>
<p><code>LOCAL</code>用于为堆栈变量预留空间。</p>
<p>局部变量：只能在过程中用，主程序里不能用；</p>
<p>堆栈变量：没有初始值，只在调用时分配。C语言中的函数值传递的本质。</p>
<h2 id="一些常用类型整理"><a href="#一些常用类型整理" class="headerlink" title="一些常用类型整理"></a>一些常用类型整理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">byte db,word dw,DWORD dd,fword df,QWORD dq,tbyte dt  1,2,4,6,8,10</span><br><span class="line">WNDCLASS</span><br></pre></td></tr></table></figure>
<ul>
<li>TYPE返回变量大小</li>
<li>LENGTHOF  返回变量元素个数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">;,用于表示一个变量是否结束</span><br><span class="line">var6 dw 10,20,30,40,50</span><br><span class="line">	 dw 60,70,80,90,99</span><br><span class="line">var7 dw 10,20,30,40,50,</span><br><span class="line">	    60,70,80,90,99	 </span><br><span class="line">LENGTHOF var6 ;5</span><br><span class="line">LENGTHOF var7 ;10</span><br></pre></td></tr></table></figure>
<ul>
<li>SIZE，SIZEOF返回所占字节数=LENGTHOF*TYPR</li>
</ul>
<h2 id="1-和EQU伪指令"><a href="#1-和EQU伪指令" class="headerlink" title="1.=和EQU伪指令"></a>1.=和EQU伪指令</h2><p>由等号或者EQU定义的符号常量<strong>不占用存储空间。</strong></p>
<p>EQU类似于等号伪指令，但是EQU伪指令不许重复定义，而等号伪指令可以（同一个常量名可重复定义多次）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">presskey EQU &lt;&quot;Output is:&quot;&gt;</span><br><span class="line">.data</span><br><span class="line">propt db presskey</span><br></pre></td></tr></table></figure>
<h2 id="2-当前地址运算符"><a href="#2-当前地址运算符" class="headerlink" title="2.$ 当前地址运算符"></a>2.$ 当前地址运算符</h2><h2 id="3-LEA伪指令"><a href="#3-LEA伪指令" class="headerlink" title="3.LEA伪指令"></a>3.LEA伪指令</h2><p>OFFSET和ADDR编译时起作用，LEA是指令，在运行时起作用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MOV ESI,ADDR BVAL  ;相当于</span><br><span class="line">LEA ESi,BVAL</span><br></pre></td></tr></table></figure>
<p>计算堆栈（程序执行是分配）变量的偏移地址时，只能用lea。</p>
<h2 id="4-PTR-操作符"><a href="#4-PTR-操作符" class="headerlink" title="4.PTR 操作符"></a>4.PTR 操作符</h2><p>按照指定类型在内存中读写值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LIST DB 12H,34H,56H,78H;</span><br><span class="line">MOV EAX,DWORD PTR LIST ;EAX  78563412H</span><br></pre></td></tr></table></figure>
<h2 id="5-ALIGN和EVEN伪指令"><a href="#5-ALIGN和EVEN伪指令" class="headerlink" title="5.ALIGN和EVEN伪指令"></a>5.ALIGN和EVEN伪指令</h2><blockquote>
<p>CPU处理偶数地址比处理奇数地址要快。 可以在一个内存访问周期内获取该数据 </p>
</blockquote>
<p>ALIGN 对齐 (1,2,4)  按照n个字节的边界值对齐</p>
<p>EVEN  使下一地址从偶数地址开始</p>
<h2 id="6-TYPEDEF和TYPEDEF-PTR操作符"><a href="#6-TYPEDEF和TYPEDEF-PTR操作符" class="headerlink" title="6.TYPEDEF和TYPEDEF PTR操作符"></a>6.TYPEDEF和TYPEDEF PTR操作符</h2><p>类型自命名和定义指针的类型，<strong>不占用存储空间</strong></p>
<h2 id="7-LABEL伪指令"><a href="#7-LABEL伪指令" class="headerlink" title="7.LABEL伪指令"></a>7.LABEL伪指令</h2><p>别名，<strong>不占用存储空间</strong></p>
<h2 id="8-基数控制伪指令RAIDX"><a href="#8-基数控制伪指令RAIDX" class="headerlink" title="8.基数控制伪指令RAIDX"></a>8.基数控制伪指令RAIDX</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.RADIX  16;默认该指令后面的数据都是16进制数，其他进制的数据需要额外说明</span><br><span class="line"></span><br><span class="line">MOV AX,0FF ;十六进制数,对应十进制255</span><br><span class="line">MOV BX ,12D ;十进制数12</span><br></pre></td></tr></table></figure>
<p>9.ORG伪指令</p>
<p>10.REPT伪指令</p>
<h2 id="11-ASSUME伪指令"><a href="#11-ASSUME伪指令" class="headerlink" title="11.ASSUME伪指令"></a>11.ASSUME伪指令</h2><p>将程序的段与逻辑段绑定。</p>
<h2 id="12-SHORT伪指令"><a href="#12-SHORT伪指令" class="headerlink" title="12.SHORT伪指令"></a>12.SHORT伪指令</h2><h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.while(条件)</span><br><span class="line">.endw</span><br><span class="line"></span><br><span class="line">.repeat</span><br><span class="line"></span><br><span class="line">until(条件)</span><br><span class="line"></span><br><span class="line">.if </span><br><span class="line">.elseif</span><br><span class="line">.endif</span><br><span class="line">.break .if ;退出循环</span><br><span class="line">.continue ;结束本次循环，进入下一次循环</span><br></pre></td></tr></table></figure>
<h2 id="14-结构体和共用体"><a href="#14-结构体和共用体" class="headerlink" title="14.结构体和共用体"></a>14.结构体和共用体</h2><h2 id="15-宏定义"><a href="#15-宏定义" class="headerlink" title="15.宏定义"></a>15.宏定义</h2><h2 id="16-过程"><a href="#16-过程" class="headerlink" title="16.过程"></a>16.过程</h2><p>模块化代码</p>
<p>PROC [NEAR] 或者[FAR]，默认近调用，即在ODS实模式下的一个段里(&lt;64KB(。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">主程序中 CALL &#123;PROC_noarg_name&#125;</span><br><span class="line"></span><br><span class="line">PUSH 参数2</span><br><span class="line">PUSH 参数1</span><br><span class="line">INVOKE &#123;PROC_noarg_name&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;PROC_noarg_name&#125; PROC [NEAR]</span><br><span class="line">	LOCAL 变量名1[重复数量]:类型,变量名2[重复数量]:类型</span><br><span class="line">	RET   ;从栈中弹出返回地址，返回到主程序</span><br><span class="line">&#123;PROC_noarg_name&#125; ENDP	</span><br><span class="line"></span><br><span class="line">&#123;PROC_name&#125; PROC,参数1:类型,参数2:类型,...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="17-ENTER和LEAVE"><a href="#17-ENTER和LEAVE" class="headerlink" title="17.ENTER和LEAVE"></a>17.ENTER和LEAVE</h2><h2 id="18-RET和RETN"><a href="#18-RET和RETN" class="headerlink" title="18.RET和RETN"></a>18.RET和RETN</h2><h2 id="19-IDA的反汇编"><a href="#19-IDA的反汇编" class="headerlink" title="19.IDA的反汇编"></a>19.IDA的反汇编</h2><h2 id="0day-安全"><a href="#0day-安全" class="headerlink" title="0day 安全"></a>0day 安全</h2><p> 文件偏移地址 = 虚拟内存地址（VA）−装载基址（Image Base）−节偏移<br>= RVA -节偏移 </p>
<p>对于 栈桢可能发生移位的情况 </p>
<h2 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h2><p> 一个函数返回时，esp正好指向原来存储返回地址的下一位，我们将shellcode从ret_addr的后一个位置开始填充，并将ret_addr填充为一个进程中的”jmp esp”的指令的地址，这样函数返回后就会跳到esp指向的栈顶的位置开始执行shellcode。 </p>
<p>缓冲区组成方式，现阶段已经讲了两种：</p>
<ol>
<li>将shellcode放到缓冲区，然后覆盖返回地址到缓冲区的起始地址。这种适用于缓冲区较大的场合。</li>
<li><p>将shellcode放到函数返回地址以后，然后覆盖返回地址为”jmp esp”之类的指令，使得函数返回时跳转到shellcode处执行指令。这种适用于缓冲区较小的场合。</p>
</li>
<li><p>找到程序运行的线程环境块TEB。</p>
</li>
<li>TEB的起始地址偏移0x30的地方指向进程环境块PEB。</li>
<li>PEB的地址偏移0x0C的地方存放指向PEB_LDR_DATA结构体的指针，该指针指向一个存放着被进程装载的动态链接库的信息的结构体。</li>
<li>PEB_LDR_DATA结构体偏移位置位0x1C的地方指向模块初始化链表的头指针InInitializationOrderModuleList。</li>
<li>4中的链表存放PE被载入时初始化的模块信息，第一个链表节点时ntdll.dll，第二个位kernel32.dll。</li>
<li>kernel32.dll的节点偏移0x08是kernel32.dll在内存中载入的基址。</li>
<li>kernel32.dll的基址加0xe3C是PE头的地址。</li>
<li>PE头偏移0x78存放着指向函数导出表的指针。</li>
<li>安照下述方法寻址：<ul>
<li>导出表偏移0x1C的指针指向存储导出函数偏移地址（RVA）的列表。</li>
<li>导出表偏移0x20指针指向存储导出函数名的列表。</li>
<li>根据函数名找到我们要的函数是导出表中的第几个，然后再地址列表中找到对应RVA。</li>
<li>RVA加上动态链接库的基址即是VA，这个也是我们在shellcode中需要的地址。</li>
</ul>
</li>
</ol>
<p>这里shellcode的构造为了尽可能的短，所以需要给每个API名字用一个hash去代替。<br>MessageBoxA：0x1e380a6a<br>ExitProcess：0x4fd18963<br>LoadLibraryA：0x0c917432</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">push 0x1e380a6a</span><br><span class="line">push 0x4fd18963 </span><br><span class="line">push 0x0c917432</span><br><span class="line">mov esi,esp</span><br><span class="line">lea edi,[esi-0xC]</span><br></pre></td></tr></table></figure>
<h2 id="如何实现一款-shellcodeLoader"><a href="#如何实现一款-shellcodeLoader" class="headerlink" title="如何实现一款 shellcodeLoader"></a>如何实现一款 shellcodeLoader</h2><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1755926">https://cloud.tencent.com/developer/article/1755926</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/CTF/rev01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/CTF/rev01/" class="post-title-link" itemprop="url">zer0pt chall题解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-16 14:19:49 / Modified: 22:07:23" itemprop="dateCreated datePublished" datetime="2023-07-16T14:19:49+08:00">2023-07-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这道题是一道已知RC4的密文和密钥，反求明文的伪装成逆向的密码题。</p>
<p><img src="/categories/CTF/rev01/1689514292270.png" alt="1689514292270"></p>
<p>​                                                                    图1</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>反汇编时，要深入每个关键函数看一看，不能想当然。</p>
<p>IDA给出的伪代码代码大部分时候还是十分正确的，直接看伪代码比反汇编代码正确率要来得高。</p>
<h2 id="干扰项："><a href="#干扰项：" class="headerlink" title="干扰项："></a>干扰项：</h2><p><img src="/categories/CTF/rev01/1689514736957.png" alt="1689514736957"></p>
<p>在IDA的反汇编界面看代码，会误以为密钥为key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key_rodata = b&quot;\xBE\xBA\xFE\xCA\xEF\xBE\xAD\xDE&quot;</span><br></pre></td></tr></table></figure>
<p>也会误认为密文为enc</p>
<p><img src="/categories/CTF/rev01/1689514809165.png" alt="1689514809165"></p>
<p>不管任何一个弄错，都会使得结果错误。</p>
<p>干扰原因：按照C调用约定，在call之前的部分应该是函数的参数部分，但是<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__int64 __usercall RC4_setkey@&lt;rax&gt;(__int64 RC4_key@&lt;r12&gt;, __int64 RC4_keytable@&lt;r13&gt;)</span><br><span class="line">char __usercall memcmp@&lt;al&gt;(unsigned int a1@&lt;edx&gt;, __int64 a2@&lt;r14&gt;)</span><br></pre></td></tr></table></figure></p>
<p>这里是作者自定义的call行为，call之前的内容并不全是函数的参数。</p>
<p>对于RC4_setkey，其真正的RC4_key是r12,。</p>
<p><img src="/categories/CTF/rev01/1689515709788.png" alt="1689515709788"></p>
<p>而r12早就被赋予了值，其值为val，在got表中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">main         push    rbp</span><br><span class="line">main+1      sub     rsp, 200h</span><br><span class="line">main+8      mov     ecx, 200h</span><br><span class="line">main+D      xor     eax, eax</span><br><span class="line">main+F      mov     rdi, rsp</span><br><span class="line">main+12     repne stosb</span><br><span class="line">main+14     mov     ebx, 6</span><br><span class="line">main+19     lea     rbp, flag       ; &quot;FLAG: &quot;</span><br><span class="line">main+20     lea     r12, val</span><br><span class="line">main+27     mov     r15, rsp</span><br><span class="line">main+2A     lea     r14, [r15+80h]</span><br><span class="line">main+31     lea     r13, [r15+100h]</span><br></pre></td></tr></table></figure>
<p>对于memcmp，也类似，在其函数内部，再次修改rsi，其真正比较的是dat和r14.</p>
<p><img src="/categories/CTF/rev01/1689516066778.png" alt="1689516066778"></p>
<p>正确的密钥和密文都在got表里</p>
<p>如图1所示，密钥应该为图1所示的val所对应的内容，密文应该为dat对应内容。</p>
<p><img src="/categories/CTF/rev01/1689515029709.png" alt="1689515029709"></p>
<h2 id="密文获取"><a href="#密文获取" class="headerlink" title="密文获取"></a>密文获取</h2><p><code>memcmp</code>里返回dat数组和传入的结果数组的比较情况，真正的密文应该是dat数组。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result |= *((_BYTE *)&amp;dat + v3) ^ *(_BYTE *)(a2 + v3);</span><br></pre></td></tr></table></figure>
<p>点击第一处字节后，按下(Alt+L)，再点击最后一处字节，就可以选定待导出的密文部分。</p>
<p><img src="/categories/CTF/rev01/1689513948497.png" alt="1689513948497"></p>
<p>Shift+E，导出Array数组，复制粘贴到python代码里。</p>
<p><img src="/categories/CTF/rev01/1689513831064.png" alt="1689513831064"></p>
<h2 id="解密代码："><a href="#解密代码：" class="headerlink" title="解密代码："></a>解密代码：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 已知的密钥表和加密文本</span></span><br><span class="line">RC4_key=     <span class="string">b&quot;\x31\x09\x81\x19\x19\x14\x45\x11&quot;</span></span><br><span class="line">cmp_data =<span class="built_in">bytes</span>([</span><br><span class="line">  <span class="number">0x78</span>, <span class="number">0xCF</span>, <span class="number">0xC4</span>, <span class="number">0x85</span>, <span class="number">0xDC</span>, <span class="number">0x33</span>, <span class="number">0x07</span>, <span class="number">0x4C</span>, <span class="number">0x93</span>, <span class="number">0x35</span>, </span><br><span class="line">  <span class="number">0xFB</span>, <span class="number">0x7C</span>, <span class="number">0x10</span>, <span class="number">0x8E</span>, <span class="number">0xBE</span>, <span class="number">0x93</span>, <span class="number">0x28</span>, <span class="number">0xE6</span>, <span class="number">0x2E</span>, <span class="number">0x75</span>, </span><br><span class="line">  <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x85</span>, <span class="number">0xC5</span>, <span class="number">0x91</span>, <span class="number">0x15</span>, <span class="number">0x75</span>, <span class="number">0x89</span>, <span class="number">0x48</span>, <span class="number">0x0E</span>, </span><br><span class="line">  <span class="number">0x29</span>, <span class="number">0xA4</span>, <span class="number">0xF9</span>, <span class="number">0xA6</span>, <span class="number">0x3A</span>, <span class="number">0x6E</span>, <span class="number">0x1F</span>, <span class="number">0x84</span>, <span class="number">0xF7</span>, <span class="number">0x42</span>, </span><br><span class="line">  <span class="number">0xB0</span>, <span class="number">0x93</span>, <span class="number">0x31</span>, <span class="number">0xF0</span>, <span class="number">0x68</span>, <span class="number">0xC0</span>, <span class="number">0x43</span>, <span class="number">0x38</span>, <span class="number">0x07</span>, <span class="number">0x32</span>, </span><br><span class="line">  <span class="number">0x09</span>, <span class="number">0x57</span>, <span class="number">0xDA</span>, <span class="number">0x32</span>, <span class="number">0x44</span>, <span class="number">0xCF</span>, <span class="number">0xCD</span>, <span class="number">0x8F</span>, <span class="number">0xE5</span>, <span class="number">0xBF</span>, </span><br><span class="line">  <span class="number">0xE3</span>, <span class="number">0xD6</span>, <span class="number">0xBB</span>, <span class="number">0x59</span>, <span class="number">0x9A</span>, <span class="number">0x6A</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0xD3</span>, <span class="number">0x22</span>, </span><br><span class="line">  <span class="number">0xA9</span>, <span class="number">0x8E</span>, <span class="number">0xB5</span>, <span class="number">0xEA</span>, <span class="number">0xBD</span>, <span class="number">0x57</span>, <span class="number">0xDE</span>, <span class="number">0xB1</span>, <span class="number">0x6C</span>, <span class="number">0x93</span>, </span><br><span class="line">  <span class="number">0xE4</span>, <span class="number">0x74</span>, <span class="number">0x70</span>, <span class="number">0xAC</span>, <span class="number">0x1A</span>, <span class="number">0x03</span>, <span class="number">0xD9</span>, <span class="number">0x16</span>, <span class="number">0x9F</span>, <span class="number">0xBC</span>, </span><br><span class="line">  <span class="number">0x97</span>, <span class="number">0xFB</span>, <span class="number">0x85</span>, <span class="number">0xD9</span>, <span class="number">0xA6</span>, <span class="number">0x9E</span>, <span class="number">0xD4</span>, <span class="number">0xD6</span>, <span class="number">0x02</span>, <span class="number">0x59</span>, </span><br><span class="line">  <span class="number">0xD5</span>, <span class="number">0x28</span>, <span class="number">0xB3</span>, <span class="number">0x93</span>, <span class="number">0x16</span>, <span class="number">0xB6</span>, <span class="number">0xC4</span>, <span class="number">0x78</span>, <span class="number">0xC4</span>, <span class="number">0xA2</span>, </span><br><span class="line">  <span class="number">0x12</span>, <span class="number">0xD2</span>, <span class="number">0xEF</span>, <span class="number">0xB1</span>, <span class="number">0x54</span>, <span class="number">0x18</span>, <span class="number">0xFD</span>, <span class="number">0x76</span>, <span class="number">0x51</span>, <span class="number">0xA3</span>, </span><br><span class="line">  <span class="number">0x5E</span>, <span class="number">0x57</span>, <span class="number">0xB8</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x1E</span>, <span class="number">0xE2</span>, <span class="number">0x41</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">RC4_setkey</span>(<span class="params">key, keytable</span>):</span><br><span class="line">    keytable_length = <span class="number">256</span><span class="comment">#len(keytable)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化密钥表</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(keytable_length):</span><br><span class="line">        keytable[i] = i</span><br><span class="line"></span><br><span class="line">    <span class="comment"># KSA (密钥调度算法)</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(keytable_length):</span><br><span class="line">        j = (j + keytable[i] + key[i % <span class="built_in">len</span>(key)]) % keytable_length</span><br><span class="line">        keytable[i], keytable[j] = keytable[j], keytable[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> keytable</span><br><span class="line"></span><br><span class="line"><span class="comment">#zer0pts要求的字符范围</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_printable_chars</span>(<span class="params">flag</span>):</span><br><span class="line">    filtered_flag = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0x20</span> &lt;= byte &lt;= <span class="number">0x7E</span>:</span><br><span class="line">            filtered_flag.append(byte)</span><br><span class="line">        <span class="comment">#else:</span></span><br><span class="line">            <span class="comment">#print(&quot;ERROR&quot;)</span></span><br><span class="line">            <span class="comment">#break</span></span><br><span class="line">    <span class="keyword">return</span> filtered_flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_keytable</span>(<span class="params">keytable, enc_text</span>):</span><br><span class="line">    flag_length = <span class="built_in">len</span>(enc_text)</span><br><span class="line">    v4 = <span class="number">0</span></span><br><span class="line">    v5 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> v3 <span class="keyword">in</span> <span class="built_in">range</span>(flag_length):</span><br><span class="line">        v4 = (v4 + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        v5 = (keytable[v4] + v5) % <span class="number">256</span></span><br><span class="line">        keytable[v4], keytable[v5] = keytable[v5], keytable[v4]</span><br><span class="line">        <span class="comment">#flag[v3] = enc_text[v3] ^ keytable[(keytable[v5] + keytable[v4]) % 256]</span></span><br><span class="line">    <span class="keyword">return</span> v4,v5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">RC4_decrypt</span>(<span class="params">keytable, enc_text,v4,v5</span>):</span><br><span class="line">    flag_length = <span class="built_in">len</span>(enc_text)</span><br><span class="line">    flag = <span class="built_in">bytearray</span>([<span class="number">0</span>] * flag_length)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> v3 <span class="keyword">in</span> <span class="built_in">range</span>(flag_length-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        flag[v3] = enc_text[v3] ^ keytable[(keytable[v5] + keytable[v4]) % <span class="number">256</span>]</span><br><span class="line">        keytable[v4], keytable[v5] = keytable[v5], keytable[v4]</span><br><span class="line">        v5 = (v5-keytable[v4]) % <span class="number">256</span></span><br><span class="line">        v4 = (v4 - <span class="number">1</span>) % <span class="number">256</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得密钥表</span></span><br><span class="line">RC4_keytable = <span class="built_in">bytearray</span>([<span class="number">0</span>] * <span class="number">520</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置密钥表</span></span><br><span class="line">RC4_setkey(RC4_key, RC4_keytable)</span><br><span class="line">hex_string = <span class="string">&#x27; &#x27;</span>.join([<span class="string">f&#x27;\\x<span class="subst">&#123;byte:02X&#125;</span>&#x27;</span> <span class="keyword">for</span> byte <span class="keyword">in</span> RC4_keytable])</span><br><span class="line"><span class="comment"># 打印密钥表</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;密钥表:\n&quot;</span>, hex_string)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获得解密需要的初始值</span></span><br><span class="line">v4,v5=gen_keytable(RC4_keytable,cmp_data)</span><br><span class="line">hex_string = <span class="string">&#x27; &#x27;</span>.join([<span class="string">f&#x27;\\x<span class="subst">&#123;byte:02X&#125;</span>&#x27;</span> <span class="keyword">for</span> byte <span class="keyword">in</span> RC4_keytable])</span><br><span class="line"><span class="comment"># 打印密钥表</span></span><br><span class="line"><span class="comment">#print(&quot;密钥表:\n&quot;, hex_string)</span></span><br><span class="line"><span class="built_in">print</span>(v4,v5)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密获取flag</span></span><br><span class="line">flag = RC4_decrypt(RC4_keytable, cmp_data,v4,v5)</span><br><span class="line">filtered_flag=filter_printable_chars(flag)</span><br><span class="line"><span class="comment"># 打印flag</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, filtered_flag.decode())</span><br></pre></td></tr></table></figure>
<p>最终结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flag: zer0pts&#123;d0n&#x27;7_4lw4y5_7ru57_d3c0mp1l3r&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/CTF/Pediy01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/CTF/Pediy01/" class="post-title-link" itemprop="url">微信多实例运行</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-10 14:19:49 / Modified: 14:59:29" itemprop="dateCreated datePublished" datetime="2023-07-10T14:19:49+08:00">2023-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> ADVAPI.dll  提供高级系统功能,Advanced，如 注册表、安全性、事件日志、服务管理等 ；</p>
<p>查看API对应的源代码路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\um</span><br></pre></td></tr></table></figure>
<h2 id="只运行一个实例"><a href="#只运行一个实例" class="headerlink" title="只运行一个实例"></a>只运行一个实例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CreateMutexA</span><br><span class="line">FindWindowA</span><br><span class="line">使用共享Section</span><br></pre></td></tr></table></figure>
<p>5.1节的Serial.exe只能运行一个实例。</p>
<p><img src="/categories/CTF/Pediy01/1688962133346.png" alt="1688962133346"></p>
<p><img src="/categories/CTF/Pediy01/1688963259744.png" alt="1688963259744"></p>
<p>修改FindWindow后面的判断逻辑即可。一开始改为了75(jnz)</p>
<p>此时可以运行多个，但是运行前需要找到已存在的一个窗口才能继续创建，再次修改程序，把jz改成jmp。</p>
<h2 id="微信"><a href="#微信" class="headerlink" title="微信"></a>微信</h2><p>先根据break定位关闭微信的函数<code>CloseWechat</code>，进而找到关键函数sub_405FD0，它控制着返回结果。</p>
<p><img src="/categories/CTF/Pediy01/1688970540191.png" alt="1688970540191"></p>
<p>关键函数<code>int __stdcall sub_405FD0(DWORD a1, int a2, int a3, int a4)</code></p>
<p>跟进去后，可以看到一开始检查注册表语言配置和更新配置。</p>
<p><img src="/categories/CTF/Pediy01/1688968867614.png" alt="1688968867614"></p>
<p>微信整体打开，靠WechatWin.dl里的函数。</p>
<p><img src="/categories/CTF/Pediy01/1688969199372.png" alt="1688969199372"></p>
<p>打开WechatWin.dll，发现其导入表里存在实例判断函数。</p>
<p><img src="/categories/CTF/Pediy01/1688969733507.png" alt="1688969733507"></p>
<p><img src="/categories/CTF/Pediy01/1688969749959.png" alt="1688969749959"></p>
<p>双击进入后，等待库加载完成，需要几分钟，之后x查看两个函数的上下文：</p>
<p>注意这里一定要多等一会，不然调用<code>CreateMutex</code>的地址可能检索不全。</p>
<p><img src="/categories/CTF/Pediy01/1688970084672.png" alt="1688970084672"></p>
<p>调用<code>FindWindowW</code>函数的上下文十分明显：</p>
<p><img src="/categories/CTF/Pediy01/1688971265497.png" alt="1688971265497"></p>
<p>对于上图尾行的这个大跳，是一个经典的判断Mutex是否存在的代码段。</p>
<blockquote>
<p>Mutex存在，则GetLastError返回 <code>ERROR_ALREADY_EXISTS</code>.，不存在时，返回0.</p>
</blockquote>
<p><img src="/categories/CTF/Pediy01/1688971805972.png" alt="1688971805972"></p>
<p>把jnz StartNewInstance改变成为jmp。</p>
<p>爆破成功。</p>
<p><img src="/categories/CTF/Pediy01/1688972258464.png" alt="1688972258464"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/Notes/Pediy01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/Notes/Pediy01/" class="post-title-link" itemprop="url">微信多实例运行</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-10 14:19:49" itemprop="dateCreated datePublished" datetime="2023-07-10T14:19:49+08:00">2023-07-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-02 16:31:08" itemprop="dateModified" datetime="2023-08-02T16:31:08+08:00">2023-08-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> ADVAPI.dll  提供高级系统功能,Advanced，如 注册表、安全性、事件日志、服务管理等 ；</p>
<p>查看API对应的源代码路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\um</span><br></pre></td></tr></table></figure>
<h2 id="只运行一个实例"><a href="#只运行一个实例" class="headerlink" title="只运行一个实例"></a>只运行一个实例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CreateMutexA</span><br><span class="line">FindWindowA</span><br><span class="line">使用共享Section</span><br></pre></td></tr></table></figure>
<p>5.1节的Serial.exe只能运行一个实例。</p>
<p><img src="/categories/Notes/Pediy01/1688962133346.png" alt="1688962133346"></p>
<p><img src="/categories/Notes/Pediy01/1688963259744.png" alt="1688963259744"></p>
<p>修改FindWindow后面的判断逻辑即可。一开始改为了75(jnz)</p>
<p>此时可以运行多个，但是运行前需要找到已存在的一个窗口才能继续创建，再次修改程序，把jz改成jmp。</p>
<h2 id="微信"><a href="#微信" class="headerlink" title="微信"></a>微信</h2><p>先根据break定位关闭微信的函数<code>CloseWechat</code>，进而找到关键函数sub_405FD0，它控制着返回结果。</p>
<p><img src="/categories/Notes/Pediy01/1688970540191.png" alt="1688970540191"></p>
<p>关键函数<code>int __stdcall sub_405FD0(DWORD a1, int a2, int a3, int a4)</code></p>
<p>跟进去后，可以看到一开始检查注册表语言配置和更新配置。</p>
<p><img src="/categories/Notes/Pediy01/1688968867614.png" alt="1688968867614"></p>
<p>微信整体打开，靠WechatWin.dl里的函数。</p>
<p><img src="/categories/Notes/Pediy01/1688969199372.png" alt="1688969199372"></p>
<p>打开WechatWin.dll，发现其导入表里存在实例判断函数。</p>
<p><img src="/categories/Notes/Pediy01/1688969733507.png" alt="1688969733507"></p>
<p><img src="/categories/Notes/Pediy01/1688969749959.png" alt="1688969749959"></p>
<p>双击进入后，等待库加载完成，需要几分钟，之后x查看两个函数的上下文：</p>
<p>注意这里一定要多等一会，不然调用<code>CreateMutex</code>的地址可能检索不全。</p>
<p><img src="/categories/Notes/Pediy01/1688970084672.png" alt="1688970084672"></p>
<p>调用<code>FindWindowW</code>函数的上下文十分明显：</p>
<p><img src="/categories/Notes/Pediy01/1688971265497.png" alt="1688971265497"></p>
<p>对于上图尾行的这个大跳，是一个经典的判断Mutex是否存在的代码段。</p>
<blockquote>
<p>Mutex存在，则GetLastError返回 <code>ERROR_ALREADY_EXISTS</code>.，不存在时，返回0.</p>
</blockquote>
<p><img src="/categories/Notes/Pediy01/1688971805972.png" alt="1688971805972"></p>
<p>把jnz StartNewInstance改变成为jmp。</p>
<p>爆破成功。</p>
<p><img src="/categories/Notes/Pediy01/1688972258464.png" alt="1688972258464"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blueinyou.com/categories/CTF/QQ%E6%8F%90%E5%8F%96%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://blueinyou.com/photos/avatar.jpg">
      <meta itemprop="name" content="Paul C">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Paul C's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/categories/CTF/QQ%E6%8F%90%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">QQ Elevation复现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-03 14:19:49 / Modified: 14:52:18" itemprop="dateCreated datePublished" datetime="2023-07-03T14:19:49+08:00">2023-07-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>利用QQProtect.exe提权，获得NT Authority\SYSTEM权限。</p>
</blockquote>
<h2 id="漏洞成因："><a href="#漏洞成因：" class="headerlink" title="漏洞成因："></a>漏洞成因：</h2><p>QQProtect.exe没有使用ASLR保护，篡改函数指针，利用ROP链（Ret Oriented Programming，即修改函数返回指针)实现了任意代码执行。</p>
<p>1.QQProtect.exe+0x40c9f8处，有<code>任意地址写漏洞</code>。</p>
<p>待添加自己的截图，网络截图可见：</p>
<p><img src="/categories/CTF/QQ%E6%8F%90%E5%8F%96%E6%BC%8F%E6%B4%9E/image0.png" alt="image0"></p>
<p>可以在任意地址写入DWORD(1)。</p>
<p>2.QQProtectEngine.dll+0x3B4F6处，</p>
<p>待添加自己的截图，网络截图可见：</p>
<p><img src="/categories/CTF/QQ%E6%8F%90%E5%8F%96%E6%BC%8F%E6%B4%9E/image1.png" alt="image1"></p>
<p>可以完成对任意地址的指针ptr，偏移2个ptr指针类型大小的位置处，赋值为(unsigned int )(ptr+3)。</p>
<p>Affected Products:</p>
<ul>
<li>QQ 9.7.1.28940 ~ 9.7.8.29039</li>
<li>TIM 3.4.5.22071 ~ 3.4.7.22084</li>
</ul>
<p>Affected Components:</p>
<ul>
<li>QQProtect.exe 4.5.0.9424 (in TIM 3.4.5.22071)</li>
<li>QQProtect.exe 4.5.0.9426 (in QQ 9.7.1.28940)</li>
<li>QQProtectEngine.dll 4.5.0.9424 (in TIM 3.4.5.22071)</li>
<li>QQProtectEngine.dll 4.5.0.9426 (in QQ 9.7.1.28940)</li>
</ul>
<h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p>POC整体用rust构建，先来解析配置文件里的内容。</p>
<h3 id="1-配置文件解析"><a href="#1-配置文件解析" class="headerlink" title="1.配置文件解析"></a>1.配置文件解析</h3><p>针对32位系统使用静态链接的C运行时，构建可执行文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo +stable-i686-pc-windows-msvc build --release --config <span class="string">&quot;build.rustflags = [\&quot;-C\&quot;, \&quot;target-feature=+crt-static\&quot;]&quot;</span></span><br></pre></td></tr></table></figure>
<p>对应的toml文件</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="section">[profile.release.overrides.&#x27;cfg(target_os = &quot;windows&quot;)&#x27;]</span></span><br><span class="line"><span class="attr">rustflags</span> = [<span class="string">&quot;-C&quot;</span>, <span class="string">&quot;target-feature=+crt-static&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>此时，只需要<code>cargo build --release</code>即可。</p>
<p>开发过程中，要利用一些依赖库，来调用Windows API、服务和命令行参数。</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies.rhexdump]</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies.windows]</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.44.0&quot;</span></span><br><span class="line"><span class="attr">features</span> = [</span><br><span class="line">    <span class="string">&quot;Win32_Foundation&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Win32_System_LibraryLoader&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Win32_System_Threading&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Win32_System_SystemServices&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Win32_System_Console&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies.windows-service]</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.5.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies.windows-args]</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.2.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成动态链接库，即dll文件</span></span><br><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">crate-type</span> = [<span class="string">&quot;cdylib&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.定义的<code>src\lib.def</code>文件中的导出符号。</p>
<h3 id="C-名称修饰规则"><a href="#C-名称修饰规则" class="headerlink" title="C++名称修饰规则"></a>C++名称修饰规则</h3><p> C++ 的名称修饰规则，也称为名称重整（name mangling）。用于编译器生成符号表，会因平台和编译器有所不同。它将函数和变量的名称、参数类型、返回类型等信息编码成一个唯一的符号。 </p>
<p>名称修饰的目的是确保在<strong>链接阶段可以正确地解析函数和变量的符号，避免符号冲突和重复定义的问题。</strong>  为了实现不同编程语言之间的互操作性，可以使用 <code>extern &quot;C&quot;</code> 来指定使用 C 风格的符号。</p>
<blockquote>
<p>导出符号的格式是 <code>?SymbolName@ClassName@@FunctionSignature=_alias@0</code> </p>
</blockquote>
<p>下面的文件规定了导出的类和符号命，并 将所有导出符号重命名为 <code>_die</code>。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LIBRARY</span><br><span class="line">EXPORTS</span><br><span class="line">    ?NextSiblingElement@TiXmlNode@@QAEPAVTiXmlElement@@PBD@Z=_die@0</span><br><span class="line">    ?FirstChildElement@TiXmlNode@@QAEPAVTiXmlElement@@PBD@Z=_die@0</span><br><span class="line">    ??1TiXmlDocument@@UAE@XZ=_die@0</span><br><span class="line">    ?RootElement@TiXmlDocument@@QAEPAVTiXmlElement@@XZ=_die@0</span><br><span class="line">    ?GetText@TiXmlElement@@QBEPBDXZ=_die@0</span><br><span class="line">    ?Attribute@TiXmlElement@@QBEPBDPBD@Z=_die@0</span><br><span class="line">    ?Attribute@TiXmlElement@@QBEPBDPBDPAH@Z=_die@0</span><br><span class="line">    ?LoadXML@TiXmlDocument@@QAE_NPADHW4TiXmlEncoding@@@Z=_die@0</span><br><span class="line">    ??0TiXmlDocument@@QAE@XZ=_die@0</span><br><span class="line">    DllMain</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> <code>QAE</code> 指示该构造函数是一个非静态成员函数，</p>
<ul>
<li><code>QB</code> 表示该函数是一个非静态成员函数，并且返回一个指针。</li>
<li><code>EPBD</code> 表示函数的第一个参数是一个 <code>const char*</code> 类型的指针。</li>
<li><code>PAH</code> 表示函数的第二个参数是一个 <code>int*</code> 类型的指针。</li>
<li><code>PAVTiXmlElement 表示返回类型是一个指向</code>TiXmlElement` 类的指针。 </li>
<li><code>0TiXmlDocument@@QAE@XZ</code>中0表示该类的默认构造函数</li>
<li><code>@Z</code>：函数参数的结尾标记 ，<code>XZ</code> 表示该构造函数不接受任何参数。 </li>
</ul>
<h3 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">CreateProcessAsUserW</span>(token2, <span class="literal">None</span>, <span class="title function_ invoke__">PWSTR</span>(<span class="string">&quot;cmd.exe&quot;</span>.<span class="title function_ invoke__">encode_utf16</span>().<span class="title function_ invoke__">chain</span>(<span class="title function_ invoke__">Some</span>(<span class="number">0</span>)).collect::&lt;<span class="type">Vec</span>&lt;<span class="type">u16</span>&gt;&gt;().<span class="title function_ invoke__">as_mut_ptr</span>()), <span class="literal">None</span>, <span class="literal">None</span>, FALSE, <span class="title function_ invoke__">PROCESS_CREATION_FLAGS</span>(<span class="number">0</span>), <span class="literal">None</span>, <span class="literal">None</span>, &amp;si, &amp;<span class="keyword">mut</span> pi).<span class="title function_ invoke__">ok</span>().<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Paul C"
      src="https://blueinyou.com/photos/avatar.jpg">
  <p class="site-author-name" itemprop="name">Paul C</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">144</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/memoryofsnow" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;memoryofsnow" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2215489940@qq.com" title="E-Mail → mailto:2215489940@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/jiyi_guoshu" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;jiyi_guoshu" rel="noopener" target="_blank"><i class="fab fa-csdn fa-fw"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Paul C</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
