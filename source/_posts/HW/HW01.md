---
title: HW Windows
date: 2024-06-15 14:19:49
categories: CTF
tags: [HW]
---
等保的存在，基础安全配置一般不会出问题。
由于安全设备的存在，所以一般不会创建用户、清除日志，但是一定会获取所有文档里信息，浏览器、密码、域控。

Windows下替换Win32，system32文件夹下的系统命令，需要很高的权限。
护网期间sysmon由于需要大量时间，基本用不到，实在找不到痕迹才用这个工具。

各大厂商对于svchost的检测非常严格。

过宝塔：Content-Type写两遍，大小写乱写，导致宝塔崩掉。

过华为WAF：多几次数据包。

## 隧道扫描与进程安全

有隧道，一定有外联，一定有进程。

查看特定用户的所有操作

```
C:\Windows\System32> .\wevtutil.exe qe Security /q:"Event/EventData/Data[@Name='TargetUserName']='Administrator'" /f:text /rd:false /c:3
```



## 日志排查
由于系统默认日志时间可能是UTC，排查linux日志可能需要看提前八个小时的日志。

4624,4625登录成功失败

4672 使用超级用户登录

4720 EventID  创建用户成功

4722 启用用户

4726 删除 用户

1102  日志删除。

登录类型字段，10，远程交互，表明可能有RDP爆破。

对于Windows,Powershell下Get-winevent,get-eventlog可将结果作为对象返回。

```

get-winevent -logname Security -FilterXpath '*/System/EventID=4624'
//使用显式凭据尝试登录
get-winevent -logname Security -FilterXpath '*/System/EventID=4648' -MaxEvents 1

get-winevent -logname Security -FilterXpath "*[System[TimeCreated[@SystemTime<'2024-06-14T20:43:57' and @SystemTime>'2024-06-15T16:09:33']]]"
//搜索事件id位403的日志
get-winevent  -FilterHashTable @{ logname= 'windows powershell';StartTime='2024/6/10';Id='403' }
get-winevent  -LogName 'windows powershell' -0ldest |where-object {$_.Id -eq '403' }
//important 
get-winevent  -FilterHashTable @{ logname= 'security';StartTime='2024/6/14';Id='4624';Data='administrator' }

get-winevent -logname Security -FilterXpath '*/System[EventID!=4624 and EventID!=4648]' -MaxEvents 1
```


4624成功登陆4625  RTP爆破

### logParser


## 域应急
zerologin漏洞，每次八个字节尝攻击；NRPC协议会产生5805日志，网络流量也会出现大量的NRPC数据包；
会产生EventID 4742  ；

可以使得域控密码置空，导致任意人员都可以登陆，可要求红方扣一分。但是红队会宁愿承受损失，拿下域控。
MS070-10漏洞，有几率导致被攻击主机蓝屏，红队RCE后挂cs马，服务器重启后上线CS码。
